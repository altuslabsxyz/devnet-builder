// api/proto/v1/devnet.proto
syntax = "proto3";

package devnetd.v1;

option go_package = "github.com/altuslabsxyz/devnet-builder/api/proto/v1;v1";

import "google/protobuf/timestamp.proto";

service DevnetService {
  rpc CreateDevnet(CreateDevnetRequest) returns (Devnet);
  rpc GetDevnet(GetDevnetRequest) returns (Devnet);
  rpc ListDevnets(ListDevnetsRequest) returns (ListDevnetsResponse);
  rpc DeleteDevnet(DeleteDevnetRequest) returns (DeleteDevnetResponse);
  rpc StartDevnet(StartDevnetRequest) returns (Devnet);
  rpc StopDevnet(StopDevnetRequest) returns (Devnet);
}

message Devnet {
  DevnetMetadata metadata = 1;
  DevnetSpec spec = 2;
  DevnetStatus status = 3;
}

message DevnetMetadata {
  string name = 1;
  int64 generation = 2;
  google.protobuf.Timestamp created_at = 3;
  google.protobuf.Timestamp updated_at = 4;
  map<string, string> labels = 5;
  map<string, string> annotations = 6;
}

message DevnetSpec {
  string plugin = 1;
  string network_type = 2;
  int32 validators = 3;
  int32 full_nodes = 4;
  string mode = 5;
  string sdk_version = 6;
  string genesis_path = 7;
  string snapshot_url = 8;
}

message DevnetStatus {
  string phase = 1;
  int32 nodes = 2;
  int32 ready_nodes = 3;
  int64 current_height = 4;
  string sdk_version = 5;
  google.protobuf.Timestamp last_health_check = 6;
  string message = 7;
}

message CreateDevnetRequest {
  string name = 1;
  DevnetSpec spec = 2;
  map<string, string> labels = 3;
}

message GetDevnetRequest { string name = 1; }
message ListDevnetsRequest { map<string, string> label_selector = 1; }
message ListDevnetsResponse { repeated Devnet devnets = 1; }
message DeleteDevnetRequest { string name = 1; }
message DeleteDevnetResponse { bool deleted = 1; }
message StartDevnetRequest { string name = 1; }
message StopDevnetRequest { string name = 1; }
